/*
 * fsm_automatic.c
 *
 *  Created on: Nov 3, 2022
 *      Author: ADMIN
 */
#include "main.h"
#include "fsm_automatic.h"


int h = 0,m = 0,s = 0;
void display(int h,int m,int s){
	int num = 0xffff;
	h = (h == 0) ? 12 : h;
	m = (m == 0) ? 12 : m;
	s = (s == 0) ? 12 : s;
	num ^= ((1<<h)|(1<<m)|(1<<s));
	GPIOA->ODR = num;
}
void fsm_automatic_run(){
	switch(status){
		case INIT:
			setTimer1(1000);
			setTimer2(5000);
			status = MODE0;
			break;
		case MODE0:
			if(timer_flag1){
				setTimer1(1000);
				s++;
				if(s == 12){
					m++;
					s = 0;
				}
				if(m == 12){
					m = 0;
					h++;
				}
				if(h == 12){
					h = 0;
				}
			}
			display(h,m,s);
			if(button_flag[0] == 1){
				button_flag[0] = 0;
				status = MODE1;
				GPIOA->ODR = 0xffff;
				setTimer2(5000);
			}
			break;
		case MODE1:
			if(timer_flag2){
				status = INIT;
			}
			if(button_flag[0]){
				button_flag[0] = 0;
				status = MODE2;
			}
			if(button_flag[1]){
				button_flag[1] = 0;
				h = (h+12+1)%12;
				setTimer2(5000);
			}
			if(button_flag[2]){
				button_flag[2] = 0;
				h = (h+12-1)%12;
				setTimer2(5000);
			}
			display(h,h,h);
			break;
		case MODE2:
			if(timer_flag2){
				status = INIT;
			}
			if(button_flag[0]){
				button_flag[0] = 0;
				status = INIT;
				setTimer2(5000);
			}
			if(button_flag[1]){
				button_flag[1] = 0;
				m = (m+12+1)%12;
				setTimer2(5000);
			}
			if(button_flag[2]){
				button_flag[2] = 0;
				m = (m+12-1)%12;
				setTimer2(5000);
			}
			display(m,m,m);
			break;
		default:
			break;
	}
}
